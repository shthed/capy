<!DOCTYPE html>
<html lang="en">
  <!--
    Layout overview
    --------------
    - UI chrome (command rail, modal sheets, and the debug console) exposes primary actions wired
      to script handlers in `capy.js`.
    - Viewport + stage: #viewport, #canvasStage, and #canvasTransform cooperate with viewState for
      pan/zoom. Pointer handlers (handlePanStart/Move/End) and applyZoom feed navigation updates.
    - Puzzle state & rendering: `state` holds palette, fills, and metadata. `renderPuzzle` uses
      `ensureRenderCache` to hydrate canvases and labels.
    - Generation pipeline: `createPuzzleData` in `puzzle-generation.js` orchestrates quantization,
      segmentation, and palette prep. `loadImage` calls this, and `applyPuzzleResult` hydrates the UI.
    - Persistence + exports: createGameSaveManager backs the Saves sheet. Autosave,
      manual saves, and exports live alongside serializeCurrentPuzzle.

    Script organization
    -------------------
    - `capy.js`: Main application runtime. Handles UI, state management, rendering, and user interactions.
    - `puzzle-generation.js`: Contains the logic for creating puzzles from images (quantization, segmentation, etc.).
    - `index.html`: Static layout and settings menu structure.
    - `styles.css`: All application styles.

    Function highlights
    -------------------
    - `applyPuzzleResult(data, metadata)`: Core function to hydrate the UI with a new puzzle.
    - `createPuzzleData(image, options)`: Entry point to the puzzle generation pipeline.
    - `renderPuzzle()`: Main rendering loop function.
    - `applyZoom()` / `handlePanMove()`: Central handlers for viewport navigation.
    - `attemptFillRegion()`: Handles the logic for filling a region with a color.
  -->
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>Image to Color-by-Number</title>
    <style>
      :root {
        --ui-scale-user: 1;
        --ui-scale-auto: 1;
        --ui-scale: calc(var(--ui-scale-user, 1) * var(--ui-scale-auto, 1));
        --app-width: 100vw;
        --app-height: 100vh;
        --viewport-padding: calc(32px * var(--ui-scale));
        --rail-padding-block: calc(10px * var(--ui-scale));
        --rail-padding-inline: calc(20px * var(--ui-scale));
      }
    </style>
    <link rel="preload" href="./styles.css" as="style" />
    <link rel="stylesheet" href="./styles.css" />

  </head>
  <body data-theme="dark">
    <script type="module" src="./capy.js"></script>
    <!-- Toast notifications -->
    <div
      id="errorToast"
      class="error-toast"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
      tabindex="-1"
      hidden
    >
      <div class="error-toast__content">
        <div class="error-toast__header">
          <p class="error-toast__title">Something went wrong</p>
          <div class="error-toast__actions">
            <button
              type="button"
              class="error-toast__copy"
              data-error-copy
              aria-label="Copy error details to clipboard"
            >
              Copy error
            </button>
            <button
              type="button"
              class="error-toast__close"
              data-error-close
              aria-label="Dismiss error notification"
            >
              Ã—
            </button>
          </div>
        </div>
        <p class="error-toast__message" data-error-message></p>
        <pre class="error-toast__stack" data-error-stack aria-label="Error details"></pre>
      </div>
    </div>
    <div id="app">
      <header id="commandRail" aria-label="Game controls">
        <button
          id="settingsButton"
          class="menu-button settings-launcher"
          type="button"
          data-testid="settings-button"
          aria-haspopup="dialog"
          aria-expanded="false"
          aria-label="Open menu"
          title="Open menu"
        >
          <span class="icon" aria-hidden="true">âš™</span>
          <span class="label visually-hidden">Menu</span>
        </button>
      </header>
      <section
        id="startHint"
        class="hidden"
        role="region"
        aria-label="Getting started"
        aria-hidden="true"
        tabindex="0"
      >
        <div class="start-hint__header">
          <div class="start-hint__badge" aria-hidden="true">âœ¦</div>
          <div class="start-hint__titles">
            <p class="start-hint__eyebrow">New session</p>
            <p class="start-hint__title">Choose how to start coloring</p>
          </div>
        </div>
        <p class="start-hint-copy">Pick a starting point and we will build your palette and canvas below.</p>
        <ul class="start-hint-list">
          <li>Drop an image or Capy save anywhere in the window.</li>
          <li>Press Enter while this card is focused to choose a file.</li>
          <li>Open the menu to load the bundled capybara sample.</li>
        </ul>
        <div class="start-hint-actions">
          <button id="startHintUpload" class="start-hint-button start-hint-button--primary" type="button">
            Upload image or save
          </button>
          <button id="closeStartHint" class="start-hint-button" type="button">Open menu</button>
        </div>
      </section>
      <!-- Canvas viewport -->
      <div id="viewport">
        <div
          id="puzzleCanvas"
          data-testid="puzzle-canvas"
          aria-label="Puzzle surface"
          role="presentation"
        ></div>
        <div id="pointerOverlay" aria-hidden="true">
          <div class="pointer-indicator"></div>
          <div class="pointer-tooltip">
            <span class="pointer-swatch" data-pointer-color-swatch aria-hidden="true"></span>
            <strong class="pointer-number" data-pointer-number></strong>
          </div>
        </div>
      </div>
      <!-- Palette dock -->
      <footer id="paletteDock" aria-label="Palette dock" data-testid="palette-dock">
        <div id="palette" role="list"></div>
      </footer>
    </div>
    <input id="fileInput" type="file" accept=".json,.capy,image/*" hidden />
    <!-- Settings sheet -->
    <div
      id="settingsSheet"
      class="sheet hidden"
      role="dialog"
      aria-label="Game menu"
      aria-hidden="true"
    >
      <div class="sheet-header">
        <div class="sheet-header-actions sheet-header-actions--start">
          <button
            id="settingsUploadButton"
            class="settings-upload"
            type="button"
            aria-label="Upload image or JSON puzzle"
          >
            Upload image
          </button>
        </div>
        <div class="sheet-heading">
          <p class="sheet-heading__hint">Menu</p>
        </div>
        <div class="sheet-header-actions">
          <button
            type="button"
            class="close-button sheet-close sheet-close--balanced"
            data-sheet-close="settings"
            aria-label="Close menu"
          >
            <span aria-hidden="true">Ã—</span>
            <span class="visually-hidden">Close</span>
          </button>
        </div>
      </div>
      <div class="sheet-body">
        <div class="settings-body">
          <div class="settings-nav"><nav class="settings-tabs" role="tablist" aria-label="Menu sections" data-settings-nav=""><button class="settings-tab" type="button" role="tab" id="settingsTab-saves" data-settings-tab="saves" data-settings-tier="basic" data-settings-available="true" aria-hidden="false" aria-controls="settingsPanel-saves" aria-selected="false">Saves</button><button class="settings-tab" type="button" role="tab" id="settingsTab-settings" data-settings-tab="settings" data-settings-tier="basic" data-settings-available="true" aria-hidden="false" aria-controls="settingsPanel-settings" data-settings-tab-default="" aria-selected="true">Settings</button><button class="settings-tab" type="button" role="tab" id="settingsTab-create" data-settings-tab="create" data-settings-tier="advanced" data-settings-available="false" hidden="" aria-hidden="true" aria-controls="settingsPanel-create" aria-selected="false">Create</button><button class="settings-tab" type="button" role="tab" id="settingsTab-guides" data-settings-tab="guides" data-settings-tier="advanced" data-settings-available="false" hidden="" aria-hidden="true" aria-controls="settingsPanel-guides" aria-selected="false">Guides</button><button class="settings-tab" type="button" role="tab" id="settingsTab-debug" data-settings-tab="debug" data-settings-tier="basic" data-settings-available="true" aria-hidden="false" aria-controls="settingsPanel-debug" aria-selected="false">Debug</button></nav></div>
          <div class="settings-content" data-settings-scroll=""><section class="settings-section settings-page" id="settingsPanel-saves" data-settings-panel="saves" data-settings-tier="basic" data-settings-available="true" aria-hidden="false" role="tabpanel" aria-labelledby="settingsTab-saves"><div class="settings-section-heading"><div class="settings-heading-row"><h3 id="settingsHeading-saves" data-settings-heading="">Saves</h3><button class="help-chip" type="button" aria-label="Manage saves" aria-describedby="tooltip-saves">?</button><span class="help-chip-bubble" id="tooltip-saves" role="tooltip">Load, rename, and export snapshots without leaving the puzzle.</span></div></div><div class="settings-panel" role="group" aria-labelledby="settingsHeading-saves"><section class="sheet-section save-manager" role="group" aria-labelledby="saveManagerHeading" data-save-section="dialog" data-settings-block="save-manager" data-settings-tier="basic" data-settings-available="true" id="saveManagerSection" aria-hidden="false"><h3 id="saveManagerHeading">Your saves</h3><div class="save-manager-list" aria-live="polite" role="list" aria-labelledby="saveManagerHeading" data-save-list=""></div><p class="save-manager-empty" data-save-empty="" hidden="">No saves yet. Create one above to start autosaving progress.</p><div class="save-manager-actions"><button type="button" data-save-snapshot="" disabled="">Save current puzzle</button><button type="button" data-reset-progress="" disabled="">Reset puzzle progress</button><button id="downloadJson" type="button" disabled="">Export puzzle JSON</button><button id="downloadSvg" type="button" disabled="">Export puzzle SVG</button></div></section></div></section><section class="settings-section settings-page" id="settingsPanel-settings" data-settings-panel="settings" data-settings-tier="basic" data-settings-available="true" aria-hidden="false" role="tabpanel" aria-labelledby="settingsTab-settings" data-settings-active="true"><div class="settings-section-heading"><div class="settings-heading-row"><h3 id="settingsHeading-settings" data-settings-heading="">Settings</h3><button class="help-chip" type="button" aria-label="Gameplay, assists, and display" aria-describedby="tooltip-settings">?</button><span class="help-chip-bubble" id="tooltip-settings" role="tooltip">Adjust play style, assists, display, and controls from one place.</span></div></div><div class="settings-panel" role="group" aria-labelledby="settingsHeading-settings"><section class="sheet-section" aria-labelledby="quickStart" data-settings-block="quickStart" data-settings-tier="basic" data-settings-available="true" aria-hidden="false"><div class="sheet-section-header"><h3 id="quickStart">Quick start</h3></div><div class="sheet-section-body"><div class="quick-actions" role="group" aria-label="Puzzle quick actions"><button class="quick-action" type="button" id="previewToggle" aria-label="Show preview" title="Show preview" aria-pressed="false" disabled="" data-testid="preview-toggle"><span class="icon" aria-hidden="true">ðŸ–¼</span><span class="label">Show preview</span></button><button class="quick-action" type="button" id="fullscreenButton" aria-label="Enter fullscreen" title="Enter fullscreen" aria-pressed="false" data-testid="fullscreen-button"><span class="icon" aria-hidden="true">â›¶</span><span class="label">Enter fullscreen</span></button></div></div><p class="control-note section-note">Open a preview or go fullscreen without leaving the puzzle.</p></section><section class="sheet-section" aria-labelledby="playStyle" data-settings-block="playStyle" data-settings-tier="basic" data-settings-available="true" aria-hidden="false"><div class="sheet-section-header"><h3 id="playStyle">Play style</h3></div><div class="sheet-section-body"><label class="toggle"><input type="checkbox" id="autoAdvanceToggle" checked=""><span class="">Jump to the next colour when finished</span></label><label class="control"><span class="">Tap forgiveness</span><select id="difficultySelect"><option value="normal" selected="">Precise (standard)</option><option value="nearby">Nearby match</option><option value="easy">Auto-select colour</option></select></label><label class="toggle"><input type="checkbox" id="showRegionLabelsToggle" checked=""><span class="">Show numbers on regions</span></label></div><p class="control-note section-note">Pick how forgiving taps should be and whether to jump to the next colour automatically.</p></section><section class="sheet-section" aria-labelledby="hintsBasics" data-settings-block="hintsBasics" data-settings-tier="basic" data-settings-available="true" aria-hidden="false"><div class="sheet-section-header"><h3 id="hintsBasics">Hints &amp; guidance</h3></div><div class="sheet-section-body"><label class="toggle"><input type="checkbox" id="hintFlashToggle" checked=""><span class="">Animate hint flashes</span></label><label class="toggle"><input type="checkbox" id="hintMatchingToggle" checked=""><span class="">Highlight every region for the active colour</span></label><label class="toggle"><input type="checkbox" id="hintHoverToggle" checked=""><span class="">Glow on hover</span></label><div class="control control-range"><div class="control-header"><label for="hintIntensity"><span class="">Hint intensity <output data-for="hintIntensity">65%</output></span></label><button class="control-reset" type="button" data-reset-target="hintIntensity" data-reset-default="65">Default</button></div><input id="hintIntensity" type="range" min="20" max="90" step="5" value="65" data-default="65"></div></div><p class="control-note section-note">Toggle hint pulses and set their brightness here. Adjust timing from Assists.</p></section><section class="sheet-section" aria-labelledby="lookAndFeel" data-settings-block="lookAndFeel" data-settings-tier="basic" data-settings-available="true" aria-hidden="false"><div class="sheet-section-header"><h3 id="lookAndFeel">Look &amp; feel</h3></div><div class="sheet-section-body"><label class="control"><span class="">Theme</span><select id="uiTheme"><option value="dark" selected="">Dark</option><option value="light">Light</option><option value="colorful">Colourful</option></select></label></div><p class="control-note section-note">Adjust the colour theme. Interface scale presets now live under Display.</p></section><section class="sheet-section" aria-labelledby="hintTiming" hidden="" data-settings-block="hintTiming" data-settings-tier="advanced" data-settings-available="false" aria-hidden="true"><div class="sheet-section-header"><h3 id="hintTiming">Hint timing</h3></div><div class="sheet-section-body"><div class="control control-range"><div class="control-header"><label for="hintFadeDuration"><span class="">Hint fade duration <output data-for="hintFadeDuration">1.2 s</output></span></label><button class="control-reset" type="button" data-reset-target="hintFadeDuration" data-reset-default="1200">Default</button></div><input id="hintFadeDuration" type="range" min="400" max="2400" step="100" value="1200" data-default="1200"></div></div><p class="control-note section-note">Control how long hint flashes stay visible. Default 1.2 s.</p></section><section class="sheet-section" aria-labelledby="paletteOrder" hidden="" data-settings-block="paletteOrder" data-settings-tier="advanced" data-settings-available="false" aria-hidden="true"><div class="sheet-section-header"><h3 id="paletteOrder">Palette order</h3></div><div class="sheet-section-body"><label class="control"><span class="">Sort the palette</span><select id="paletteSort" disabled="" data-testid="palette-sort"><option value="region">Number</option><option value="remaining">Remaining regions</option><option value="name">Colour name</option><option value="spectrum">Rainbow spectrum</option><option value="warmth">Warm â†’ cool</option><option value="lightness">Perceptual lightness</option></select></label></div><p class="control-note section-note">Reorder swatches after a puzzle loads: by number, remaining regions, colour name, or spectrum.</p></section><section class="sheet-section" aria-labelledby="uiScalePreset" data-settings-block="uiScalePreset" data-settings-tier="basic" data-settings-available="true" aria-hidden="false"><div class="sheet-section-header"><h3 id="uiScalePreset">Interface scale</h3></div><div class="sheet-section-body"><label class="control"><span class="">Interface size <output data-for="uiScale">Standard (100%)</output></span><select id="uiScale"><option value="0.85">Compact (85%)</option><option value="1" selected="">Standard (100%)</option><option value="1.15">Comfortable (115%)</option><option value="1.3">Roomy (130%)</option><option value="1.5">Large (150%)</option><option value="1.75">Extra large (175%)</option><option value="2">Huge (200%)</option><option value="2.5">Giant (250%)</option></select></label><p class="control-note">Choose a preset for buttons and menus without affecting puzzle colours. Default 100%.</p></div></section><section class="sheet-section" aria-labelledby="labeling" hidden="" data-settings-block="labeling" data-settings-tier="advanced" data-settings-available="false" aria-hidden="true"><div class="sheet-section-header"><h3 id="labeling">Labels &amp; zoom</h3></div><div class="sheet-section-body"><div class="control control-range"><div class="control-header"><label for="labelScale"><span class="">Label size <output data-for="labelScale">100%</output></span></label><button class="control-reset" type="button" data-reset-target="labelScale" data-reset-default="1">Default</button></div><input id="labelScale" type="range" min="0.2" max="2" step="0.05" value="1" data-default="1"></div><p class="control-note">Scale region numbers independently from the surrounding interface. Default 100%.</p><div class="control control-range"><div class="control-header"><label for="maxZoom"><span class="">Maximum zoom <output data-for="maxZoom">1200%</output></span></label><button class="control-reset" type="button" data-reset-target="maxZoom" data-reset-default="12">Default</button></div><input id="maxZoom" type="range" min="2" max="30" step="0.5" value="12" data-default="12"></div><p class="control-note">Limit how far the canvas can zoom in beyond the fitted view. Default 1200%.</p><label class="control"><span class="">Renderer</span><select id="rendererMode"><option value="svg" selected="">SVG</option></select></label><p class="control-note">Rendering is handled by the simplified SVG backend.</p></div></section><section class="sheet-section" aria-labelledby="backgrounds" hidden="" data-settings-block="backgrounds" data-settings-tier="advanced" data-settings-available="false" aria-hidden="true"><div class="sheet-section-header"><h3 id="backgrounds">Backgrounds</h3></div><div class="sheet-section-body"><label class="control"><span class="">Unfilled region colour</span><input type="color" id="backgroundColor" value="#f8fafc"></label><p class="control-note">Applies to unfinished regions and adjusts outline contrast automatically.</p><label class="control"><span class="">Background</span><input type="color" id="stageBackgroundColor" value="#000000"></label><p class="control-note">Adjust the area surrounding the puzzle canvas.</p></div></section><section class="sheet-section" aria-labelledby="mouseControlsHeading" hidden="" data-settings-block="mouseControlsHeading" data-settings-tier="advanced" data-settings-available="false" aria-hidden="true"><div class="sheet-section-header"><h3 id="mouseControlsHeading">Mouse controls</h3><p class="control-note section-description">Assign actions to each mouse button when clicking or click-dragging on the canvas.</p></div><div class="sheet-section-body"><div class="mouse-controls"><div class="mouse-controls-grid" role="group" aria-label="Mouse controls"><div class="mouse-control-card" role="group" aria-label="Left button"><div class="mouse-control-card-header"><span class="mouse-control-title">Left button</span><span class="mouse-control-subtitle" aria-hidden="true">Click and drag bindings</span></div><div class="mouse-control-rows"><label class="control mouse-control-row"><span class="mouse-control-row-label">Click</span><select id="mouseLeftClick"><option value="fill" selected="">Fill region</option><option value="select-fill">Select and fill region</option><option value="select">Select colour</option><option value="zoom-in">Zoom in</option><option value="zoom-out">Zoom out</option><option value="none">No action</option></select></label><label class="control mouse-control-row"><span class="mouse-control-row-label">Click + drag</span><select id="mouseLeftDrag"><option value="pan" selected="">Pan view</option><option value="fill">Fill while dragging</option><option value="zoom">Zoom</option><option value="none">No action</option></select></label></div></div><div class="mouse-control-card" role="group" aria-label="Middle button"><div class="mouse-control-card-header"><span class="mouse-control-title">Middle button</span><span class="mouse-control-subtitle" aria-hidden="true">Click and drag bindings</span></div><div class="mouse-control-rows"><label class="control mouse-control-row"><span class="mouse-control-row-label">Click</span><select id="mouseMiddleClick"><option value="fill">Fill region</option><option value="select-fill">Select and fill region</option><option value="select">Select colour</option><option value="zoom-in">Zoom in</option><option value="zoom-out">Zoom out</option><option value="none" selected="">No action</option></select></label><label class="control mouse-control-row"><span class="mouse-control-row-label">Click + drag</span><select id="mouseMiddleDrag"><option value="pan" selected="">Pan view</option><option value="fill">Fill while dragging</option><option value="zoom">Zoom</option><option value="none">No action</option></select></label></div></div><div class="mouse-control-card" role="group" aria-label="Right button"><div class="mouse-control-card-header"><span class="mouse-control-title">Right button</span><span class="mouse-control-subtitle" aria-hidden="true">Click and drag bindings</span></div><div class="mouse-control-rows"><label class="control mouse-control-row"><span class="mouse-control-row-label">Click</span><select id="mouseRightClick"><option value="fill">Fill region</option><option value="select-fill">Select and fill region</option><option value="select" selected="">Select colour</option><option value="zoom-in">Zoom in</option><option value="zoom-out">Zoom out</option><option value="none">No action</option></select></label><label class="control mouse-control-row"><span class="mouse-control-row-label">Click + drag</span><select id="mouseRightDrag"><option value="pan" selected="">Pan view</option><option value="fill">Fill while dragging</option><option value="zoom">Zoom</option><option value="none">No action</option></select></label></div></div></div></div><p class="control-note">Drag-to-zoom adjusts the view by moving up to zoom in or down to zoom out.</p></div></section></div></section><section class="settings-section settings-page" id="settingsPanel-create" data-settings-panel="create" data-settings-tier="advanced" data-settings-available="false" hidden="" aria-hidden="true" role="tabpanel" aria-labelledby="settingsTab-create"><div class="settings-section-heading"><div class="settings-heading-row"><h3 id="settingsHeading-create" data-settings-heading="">Create</h3><button class="help-chip" type="button" aria-label="Puzzle creation" aria-describedby="tooltip-create">?</button><span class="help-chip-bubble" id="tooltip-create" role="tooltip">Tune imports and generation settings for new puzzles.</span></div></div><div class="settings-panel" role="group" aria-labelledby="settingsHeading-create"><div class="generator-import-notice" data-import-notice="" role="status" aria-live="polite" hidden="" aria-hidden="true" data-settings-block="import-notice" data-settings-tier="advanced" data-settings-available="false"><p class="generator-import-title"><strong data-import-file=""></strong></p><p class="generator-import-description" data-import-description=""></p><div class="generator-import-actions"><button id="confirmImport" type="button" data-import-confirm="">Generate puzzle</button><button class="close-button" type="button" data-import-cancel="">Cancel</button></div></div><section class="sheet-section" aria-labelledby="generatorHeading" hidden="" data-settings-block="generatorHeading" data-settings-tier="advanced" data-settings-available="false" aria-hidden="true"><div class="sheet-section-header"><h3 id="generatorHeading">Clustering &amp; detail</h3><p class="control-note section-description">Tune the colour clustering pipeline that powers new puzzles. These settings apply to fresh imports and the bundled capybara sample when reloaded.</p></div><div class="sheet-section-body"><div class="detail-callout"><p class="detail-intro">Capybara sample detail presets</p><div class="detail-picker" role="group" aria-label="Capybara sample detail presets"><button class="detail-chip" type="button" data-detail-level="low">Low</button><button class="detail-chip" type="button" data-detail-level="medium">Medium</button><button class="detail-chip" type="button" data-detail-level="high">High</button></div><p class="detail-caption" data-detail-caption=""></p></div><p class="control-note">Switching presets updates every slider below and reloads the sample scene when it's active.</p><div class="control control-range"><div class="control-header"><label for="colorCount"><span class="">Colours <output data-for="colorCount">12</output></span></label><button class="control-reset" type="button" data-reset-target="colorCount" data-reset-default="12">Default</button></div><input id="colorCount" type="range" min="4" max="64" value="12" data-default="12"></div><div class="control control-range"><div class="control-header"><label for="minRegion"><span class="">Regions <output data-for="minRegion">60 pxÂ²</output></span></label><button class="control-reset" type="button" data-reset-target="minRegion" data-reset-default="60">Default</button></div><input id="minRegion" type="range" min="1" max="600" value="60" data-default="60"></div><p class="control-note">Higher values merge smaller areas for fewer regions. Default 60 pxÂ².</p><div class="control control-range"><div class="control-header"><label for="detailLevel"><span class="">Detail <output data-for="detailLevel">640 px</output></span></label><button class="control-reset" type="button" data-reset-target="detailLevel" data-reset-default="640">Default</button></div><input id="detailLevel" type="range" min="256" max="1600" step="64" value="640" data-default="640"></div><p class="control-note">Controls the longest edge used when resizing the source image. Default 640 px.</p><label class="control"><span class="">Algorithm</span><select id="generationAlgorithm"><option value="local-kmeans">Local palette clustering (k-means)</option><option value="local-posterize">Local posterize &amp; merge</option><option value="organic-slic">Organic superpixels (curved gradients)</option></select></label><p class="control-note">Choose between local clustering pipelines now, with space for hosted services to appear as they become available.</p><div class="control control-range"><div class="control-header"><label for="sampleRate"><span class="">Sample rate <output data-for="sampleRate">50%</output></span></label><button class="control-reset" type="button" data-reset-target="sampleRate" data-reset-default="50">Default</button></div><input id="sampleRate" type="range" min="25" max="100" step="5" value="50" data-default="50"></div><p class="control-note">Lower values speed up clustering by sampling fewer pixels. Default 50%.</p><div class="control control-range"><div class="control-header"><label for="kmeansIters"><span class="">Iterations <output data-for="kmeansIters">12</output></span></label><button class="control-reset" type="button" data-reset-target="kmeansIters" data-reset-default="12">Default</button></div><input id="kmeansIters" type="range" min="4" max="32" step="1" value="12" data-default="12"></div><p class="control-note">Iterations rerun the clustering stage; higher counts refine colour centroids but take longer to process. Default 12 iterations.</p><div class="control control-range"><div class="control-header"><label for="smoothingPasses"><span class="">Smoothing passes <output data-for="smoothingPasses">0</output></span></label><button class="control-reset" type="button" data-reset-target="smoothingPasses" data-reset-default="0">Default</button></div><input id="smoothingPasses" type="range" min="0" max="4" step="1" value="0" data-default="0"></div><p class="control-note">Each pass blends stray pixels into neighbouring regions before segmentationâ€”set to 0 to keep edges as crisp as the source. Default 0 passes.</p><details class="advanced-options" id="generatorAdvanced"><summary>Advanced options</summary><label class="control"><span class="">Merge passes</span><textarea id="mergePasses" rows="3" placeholder=""></textarea></label><p class="control-note">Limits how many merge sweeps run after segmentation to avoid oscillation. Default 12 passes.</p><label class="control"><span class="">Perimeter/area limit</span><textarea id="perimeterRatio" rows="3" placeholder=""></textarea></label><p class="control-note">Regions above this perimeter-to-area ratio merge into dominant neighbours; set to 0 to disable. Default 1.6.</p><label class="control"><span class="">Art prompt</span><textarea id="artPrompt" rows="3" placeholder="Summarise the idea behind this puzzle"></textarea></label><p class="control-note">Stored with saves so you can revisit the inspiration that sparked the artwork.</p><label class="control"><span class="">Image description</span><textarea id="imageDescription" rows="3" placeholder="Describe the image you want to generate"></textarea></label><p class="control-note">Stored with saves and exports so you can revisit the inspiration later.</p><p class="control-note"><a class="chatgpt-link" id="chatGptLink" href="https://chat.openai.com/" target="_blank" rel="noopener noreferrer">Open ChatGPT to craft an image prompt<span aria-hidden="true"> â†—</span></a></p></details></div></section><form class="sheet-section" data-source-url-form=""><h3 id="sourceUrlHeading">Import from URL</h3><p class="control-note">Enter an https:// link to load an image directly.</p><label class="control"><span class="">Image URL</span><input type="url" inputmode="url" data-source-url-input="" aria-describedby="sourceUrlHint sourceUrlError"></label><p class="control-note" id="sourceUrlHint">External sites must allow cross-origin image access.</p><p class="control-note" id="sourceUrlError" role="alert" hidden=""></p><div class="panel-actions"><button type="submit" data-source-url-submit="" disabled="">Load image</button></div></form><div class="sheet-actions"><button id="applyOptions" disabled="">Apply changes</button></div><div class="generator-progress" data-generator-progress="" role="status" aria-live="polite" hidden=""><p class="generator-progress-message" data-generator-progress-message=""></p><div class="generator-progress-meter" data-generator-progress-meter="" role="progressbar" aria-label="Puzzle generation progress" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-hidden="true"><div class="generator-progress-bar" data-generator-progress-bar=""></div></div></div></div></section><section class="settings-section settings-page" id="settingsPanel-guides" data-settings-panel="guides" data-settings-tier="advanced" data-settings-available="false" hidden="" aria-hidden="true" role="tabpanel" aria-labelledby="settingsTab-guides"><div class="settings-section-heading"><div class="settings-heading-row"><h3 id="settingsHeading-guides" data-settings-heading="">Guides</h3><button class="help-chip" type="button" aria-label="Gestures, shortcuts, and documentation" aria-describedby="tooltip-guides">?</button><span class="help-chip-bubble" id="tooltip-guides" role="tooltip">Review inputs, commands, and the built-in README without leaving the puzzle.</span></div></div><div class="settings-panel" role="group" aria-labelledby="settingsHeading-guides"><section class="sheet-section" aria-labelledby="commandsHeading" hidden="" data-settings-block="commandsHeading" data-settings-tier="advanced" data-settings-available="false" aria-hidden="true"><div class="sheet-section-header"><h3 id="commandsHeading">Command buttons</h3></div><div class="sheet-section-body"><dl class="command-list"><div><dt>ðŸ–¼ Preview</dt><dd>Toggle the finished artwork overlay to compare your progress.</dd></div><div><dt>ðŸŽ› Generator</dt><dd>Adjust clustering sliders, choose capybara detail presets, reload the current source image, and monitor generation progress. The sheet mirrors the k-means pipeline inputs used for puzzle creation.</dd></div><div><dt>ðŸŽš Detail</dt><dd>Toggle the capybara detail chips in the Generator sheet to reload the sample with tuned palette sizes, minimum region areas, resize targets, and the region counts noted above.</dd></div><div><dt>â›¶ Fullscreen</dt><dd>Expand the app to fill the display or exit back to windowed mode.</dd></div><div><dt>â¬† Import</dt><dd>Load a new image or JSON puzzle from disk.</dd></div><div><dt>ðŸ’¾ Saves</dt><dd>Manage snapshots â€” load, rename, export, or delete stored games.</dd></div><div><dt>â„¹ Help</dt><dd>Open this guide and review tips for palette controls, gestures, and shortcuts.</dd></div><div><dt>âš™ Menu</dt><dd>Toggle auto-advance, customise hints, change the background or theme, sort the palette, and adjust the interface scale. Advanced options expose accessibility tweaks for the hint animations.</dd></div></dl></div></section><section class="sheet-section" aria-labelledby="controlsHeading" hidden="" data-settings-block="controlsHeading" data-settings-tier="advanced" data-settings-available="false" aria-hidden="true"><div class="sheet-section-header"><h3 id="controlsHeading">Canvas controls</h3></div><div class="sheet-section-body"><ul class="control-list"><li>Click Fill the tapped region if it matches the active colour.</li><li>Right click Select the colour under the pointer.</li><li>Select a palette swatch to set the active colour and flash every matching region.</li><li>Enable Easy difficulty in the menu to let clicks auto-select the tapped region's colour.</li><li>Mouse wheel or +/âˆ’ Zoom in or out around the cursor.</li><li>Middle click or Space + drag Pan the canvas.</li><li>Drag &amp; drop an image or JSON file anywhere on the window to import it.</li></ul></div></section></div></section><section class="settings-section settings-page" id="settingsPanel-debug" data-settings-panel="debug" data-settings-tier="basic" data-settings-available="true" aria-hidden="false" role="tabpanel" aria-labelledby="settingsTab-debug"><div class="settings-section-heading"><div class="settings-heading-row"><h3 id="settingsHeading-debug" data-settings-heading="">Debug</h3><button class="help-chip" type="button" aria-label="Debug and system info" aria-describedby="tooltip-debug">?</button><span class="help-chip-bubble" id="tooltip-debug" role="tooltip">Inspect logs and service worker state while troubleshooting.</span></div></div><div class="settings-panel" role="group" aria-labelledby="settingsHeading-debug"><section class="sheet-section" aria-label="Menu loader console"><div class="visually-hidden" id="settingsLoadHeading">Menu loader console</div><div id="settingsLoadConsole" class="debug-log settings-loading-console" role="log" aria-labelledby="settingsLoadHeading" aria-live="polite" aria-relevant="additions text"></div></section><section class="sheet-section" aria-labelledby="advancedSettings" data-settings-block="advancedSettings" data-settings-tier="basic" data-settings-available="true" aria-hidden="false"><div class="sheet-section-header"><h3 id="advancedSettings">Advanced settings</h3></div><div class="sheet-section-body"><p class="control-note">Show experimental controls and deeper configuration across the menu.</p><label class="toggle"><input type="checkbox" id="advancedModeToggle"><span class="">Show advanced settings</span></label></div></section><section class="sheet-section" aria-labelledby="systemHeading" data-settings-block="systemHeading" data-settings-tier="basic" data-settings-available="true" aria-hidden="false"><div class="sheet-section-header"><h3 id="systemHeading">System status</h3></div><div class="sheet-section-body"><dl class="command-list"><div><dt>Service worker</dt><dd data-service-worker-state="">Waiting to registerâ€¦</dd></div><div><dt>Runtime cache</dt><dd data-service-worker-cache="">capy-offline-cache-v3</dd></div><div><dt>Last update</dt><dd data-service-worker-updated="">Not available yet</dd></div></dl><p class="control-note">Service worker registration, cache limits, and install events stream into the debug log below.</p></div></section><section class="sheet-section" aria-labelledby="saveMaintenance" data-settings-block="saveMaintenance" data-settings-tier="basic" data-settings-available="true" aria-hidden="false"><div class="sheet-section-header"><h3 id="saveMaintenance">Saves</h3></div><div class="sheet-section-body"><div class="log-actions"><button type="button" id="deleteAllSaves">Delete all saves</button></div></div></section><section class="sheet-section" aria-labelledby="debugHeading" data-settings-block="debugHeading" data-settings-tier="basic" data-settings-available="true" aria-hidden="false"><div class="sheet-section-header"><h3 id="debugHeading">Debug log</h3></div><div class="sheet-section-body"><div id="debugLog" class="debug-log" role="log" aria-live="polite" aria-relevant="additions text"></div><div class="log-actions"><button type="button" id="clearDebugLog">Clear log</button></div></div></section><section class="sheet-section" aria-labelledby="settingsJsonHeading" data-settings-block="settingsJsonHeading" data-settings-tier="basic" data-settings-available="true" aria-hidden="false"><div class="sheet-section-header"><h3 id="settingsJsonHeading">Preferences JSON</h3></div><div class="sheet-section-body"><p class="control-note">Review or update the current preferences as JSON. Export a snapshot or import one from the textarea below.</p><div><label class="visually-hidden" for="settingsJsonView">Preferences JSON</label><textarea id="settingsJsonView" class="json-view" rows="8" spellcheck="false"></textarea><div class="json-actions"><button id="refreshSettingsJson" type="button">Refresh</button><button id="exportSettingsJson" type="button">Export JSON</button><button id="applySettingsJson" type="button">Import JSON</button><label class="json-upload"><input id="importSettingsFile" type="file" accept="application/json" hidden=""><span role="button" aria-controls="importSettingsFile">Upload file</span></label></div></div></div></section></div></section></div>
        </div>
      </div>
    </div>
  </body>
</html>
