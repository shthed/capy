<!DOCTYPE html>
<html lang="en">
  <!--
    Developer Map
    ==========
    Layout overview
    --------------
    - UI chrome (command rail, modal sheets, and the debug console) exposes primary actions wired
      to script handlers. Scan for "Command button" listeners when adjusting layout interactions.
    - Viewport + stage: #viewport, #canvasStage, and #canvasTransform cooperate with viewState for
      pan/zoom. Pointer handlers (handlePanStart/Move/End) and applyZoom feed navigation updates.
    - Puzzle state & rendering: state holds palette, fills, and metadata. renderPuzzle â†’
      drawOutlines/drawNumbers use ensureRenderCache to hydrate canvases and labels.
    - Generation pipeline: loadImage â†’ createPuzzleData orchestrates quantization, segmentation,
      and palette prep. Regeneration, fixture loading, and saves all call applyPuzzleResult.
    - Persistence + exports: createGameSaveManager backs the Saves sheet. Autosave,
      manual saves, and exports live alongside serializeCurrentPuzzle.
    - External API: window.capyGenerator exposes devtools entry points; keep signatures stable when
      reorganizing internal wiring.

    Script organization
    -------------------
    1. Cached DOM references, constants, and default settings.
    2. Canvas metrics, view state, pointer capture, and custom cursor helpers.
    3. Generation + rendering pipeline (loadDefaultPuzzle, createPuzzleData, renderPuzzle, etc.).
    4. Palette interactions, keyboard/mouse handlers, and hint overlay animation loop.
    5. Autosave + storage encoding, save manager wiring, and UI refresh routines.
    6. window.capyGenerator bindings exported last for manual QA tooling.

    Function highlights
    -------------------
    - installBrowserZoomGuards(): Prevents browser zoom from intercepting wheel gestures on the
      canvas.
    - applyViewTransform(options): Pushes viewState pan/zoom changes to the stage and pointer
      overlays.
    - applyZoom(multiplier, clientX, clientY, options): Normalizes zoom gestures around the pointer
      focus and updates viewState.
    - resetView(options): Fits the puzzle to the viewport and recenters the stage.
    - loadSamplePuzzle(options) / loadDefaultPuzzle(options): Bootstrap the bundled sample or
      fallback puzzle payload.
    - createPuzzleData(image, options): Invokes the generation worker to quantize colors and
      segment regions.
    - applyPuzzleResult(data, metadata): Hydrates puzzle state, triggers canvas redraw, and updates
      metadata surfaces.
    - renderPuzzle() / renderPreview(): Draw the active puzzle and thumbnail preview using the
      shared render cache.
    - renderPalette(): Rebuilds the palette dock and accessibility metadata for the active colors.
    - attemptFillRegion(hit, { label }): Processes paint interactions, updates fills, and schedules
      autosave.
    - useHint(): Coordinates palette flashing + overlay animations to guide the next region.
    - updateCommandStates(): Enables/disables command rail buttons based on current puzzle state.
    - applyTheme(theme, options) / applyBackgroundColor(hex, options): Refresh UI theming tokens and
      persist preferences.
    - scheduleAutosave(reason) / persistAutosave(reason): Manage background save cadence and writes
      to storage.
    - saveCurrentSnapshot(): Captures a manual save entry and refreshes manager lists.
    - refreshGameSelection() / refreshSaveList(): Render save management surfaces from shared
      templates.
    - createGameSaveManager(): Wraps persistence with list, subscribe, and persist helpers for UI
      consumers.
  -->
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>Image to Color-by-Number</title>
    <style>
      :root {
        --ui-scale-user: 1;
        --ui-scale-auto: 1;
        --ui-scale: calc(var(--ui-scale-user, 1) * var(--ui-scale-auto, 1));
        --app-width: 100vw;
        --app-height: 100vh;
        --viewport-padding: calc(32px * var(--ui-scale));
        --rail-padding-block: calc(10px * var(--ui-scale));
        --rail-padding-inline: calc(20px * var(--ui-scale));
      }
    </style>
    <link rel="preload" href="./styles.css" as="style" />
    <link rel="stylesheet" href="./styles.css" />

  </head>
  <body data-theme="dark">
    <script type="module" src="./capy.js"></script>
    <!-- Toast notifications -->
    <div
      id="errorToast"
      class="error-toast"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
      tabindex="-1"
      hidden
    >
      <div class="error-toast__content">
        <div class="error-toast__header">
          <p class="error-toast__title">Something went wrong</p>
          <div class="error-toast__actions">
            <button
              type="button"
              class="error-toast__copy"
              data-error-copy
              aria-label="Copy error details to clipboard"
            >
              Copy error
            </button>
            <button
              type="button"
              class="error-toast__close"
              data-error-close
              aria-label="Dismiss error notification"
            >
              Ã—
            </button>
          </div>
        </div>
        <p class="error-toast__message" data-error-message></p>
        <pre class="error-toast__stack" data-error-stack aria-label="Error details"></pre>
      </div>
    </div>
    <div id="app">
      <header id="commandRail" aria-label="Game controls">
        <button
          id="settingsButton"
          class="menu-button settings-launcher"
          type="button"
          data-testid="settings-button"
          aria-haspopup="dialog"
          aria-expanded="false"
          aria-label="Open menu"
          title="Open menu"
        >
          <span class="icon" aria-hidden="true">âš™</span>
          <span class="label visually-hidden">Menu</span>
        </button>
      </header>
      <section
        id="startHint"
        class="hidden"
        role="region"
        aria-label="Getting started"
        aria-hidden="true"
        tabindex="0"
      >
        <div class="start-hint__header">
          <div class="start-hint__badge" aria-hidden="true">âœ¦</div>
          <div class="start-hint__titles">
            <p class="start-hint__eyebrow">New session</p>
            <p class="start-hint__title">Choose how to start coloring</p>
          </div>
        </div>
        <p class="start-hint-copy">Pick a starting point and we will build your palette and canvas below.</p>
        <ul class="start-hint-list">
          <li>Drop an image or Capy save anywhere in the window.</li>
          <li>Press Enter while this card is focused to choose a file.</li>
          <li>Open the menu to load the bundled capybara sample.</li>
        </ul>
        <div class="start-hint-actions">
          <button id="startHintUpload" class="start-hint-button start-hint-button--primary" type="button">
            Upload image or save
          </button>
          <button id="closeStartHint" class="start-hint-button" type="button">Open menu</button>
        </div>
      </section>
      <!-- Canvas viewport -->
      <div id="viewport">
        <div id="canvasStage">
          <div id="canvasTransform">
            <div
              id="puzzleCanvas"
              data-testid="puzzle-canvas"
              aria-label="Puzzle surface"
              role="presentation"
              style="width: 640px; height: 480px"
            ></div>
          </div>
        </div>
        <div id="pointerOverlay" aria-hidden="true">
          <div class="pointer-indicator"></div>
          <div class="pointer-tooltip">
            <span class="pointer-swatch" data-pointer-color-swatch aria-hidden="true"></span>
            <strong class="pointer-number" data-pointer-number></strong>
          </div>
        </div>
      </div>
      <!-- Palette dock -->
      <footer id="paletteDock" aria-label="Palette dock" data-testid="palette-dock">
        <div id="palette" role="list"></div>
      </footer>
    </div>
    <input id="fileInput" type="file" accept=".json,.capy,image/*" hidden />
    <!-- Settings sheet -->
    <div
      id="settingsSheet"
      class="sheet hidden"
      role="dialog"
      aria-label="Game menu"
      aria-hidden="true"
    >
      <div class="sheet-header">
        <div class="sheet-header-actions sheet-header-actions--start">
          <button
            id="settingsUploadButton"
            class="settings-upload"
            type="button"
            aria-label="Upload image or JSON puzzle"
          >
            Upload image
          </button>
        </div>
        <div class="sheet-heading">
          <p class="sheet-heading__hint">Menu</p>
        </div>
        <div class="sheet-header-actions">
          <button
            type="button"
            class="close-button sheet-close sheet-close--balanced"
            data-sheet-close="settings"
            aria-label="Close menu"
          >
            <span aria-hidden="true">Ã—</span>
            <span class="visually-hidden">Close</span>
          </button>
        </div>
      </div>
      <div class="sheet-body">
        <div class="settings-body">
          <div class="settings-nav">
            <nav class="settings-tabs" role="tablist" aria-label="Menu sections" data-settings-nav></nav>
          </div>
          <div class="settings-content" data-settings-scroll></div>
        </div>
      </div>
    </div>
    <script id="settingsDefinition" type="application/json">
[
  {
    "id": "saves",
    "label": "Saves",
    "heading": {
      "title": "Saves",
      "helpLabel": "Manage saves",
      "helpText": "Load, rename, and export snapshots without leaving the puzzle."
    },
    "sections": [
      {
        "type": "save-manager"
      }
    ]
  },
  {
    "id": "settings",
    "label": "Settings",
    "default": true,
    "heading": {
      "title": "Settings",
      "helpLabel": "Gameplay, assists, and display",
      "helpText": "Adjust play style, assists, display, and controls from one place."
    },
    "sections": [
      {
        "id": "quickStart",
        "title": "Quick start",
        "layout": "actions",
        "items": [
          {
            "type": "action",
            "id": "previewToggle",
            "label": "Show preview",
            "icon": "ðŸ–¼",
            "ariaLabel": "Show preview",
            "testId": "preview-toggle",
            "ariaPressed": false,
            "disabled": true
          },
          {
            "type": "action",
            "id": "fullscreenButton",
            "label": "Enter fullscreen",
            "icon": "â›¶",
            "ariaLabel": "Enter fullscreen",
            "testId": "fullscreen-button",
            "ariaPressed": false
          }
        ],
        "note": "Open a preview or go fullscreen without leaving the puzzle."
      },
      {
        "id": "playStyle",
        "title": "Play style",
        "items": [
          {
            "type": "toggle",
            "id": "autoAdvanceToggle",
            "label": "Jump to the next colour when finished",
            "checked": true
          },
          {
            "type": "select",
            "id": "difficultySelect",
            "label": "Tap forgiveness",
            "options": [
              {
                "value": "normal",
                "label": "Precise (standard)",
                "selected": true
              },
              {
                "value": "nearby",
                "label": "Nearby match"
              },
              {
                "value": "easy",
                "label": "Auto-select colour"
              }
            ]
          },
          {
            "type": "toggle",
            "id": "showRegionLabelsToggle",
            "label": "Show numbers on regions",
            "checked": true
          }
        ],
        "note": "Pick how forgiving taps should be and whether to jump to the next colour automatically."
      },
      {
        "id": "hintsBasics",
        "title": "Hints & guidance",
        "items": [
          {
            "type": "toggle",
            "id": "hintFlashToggle",
            "label": "Animate hint flashes",
            "checked": true
          },
          {
            "type": "toggle",
            "id": "hintMatchingToggle",
            "label": "Highlight every region for the active colour",
            "checked": true
          },
          {
            "type": "toggle",
            "id": "hintHoverToggle",
            "label": "Glow on hover",
            "checked": true
          },
          {
            "type": "range",
            "id": "hintIntensity",
            "label": "Hint intensity",
            "min": 20,
            "max": 90,
            "step": 5,
            "value": 65,
            "default": 65,
            "format": "percent"
          }
        ],
        "note": "Toggle hint pulses and set their brightness here. Adjust timing from Assists."
      },
      {
        "id": "lookAndFeel",
        "title": "Look & feel",
        "items": [
          {
            "type": "select",
            "id": "uiTheme",
            "label": "Theme",
            "options": [
              {
                "value": "dark",
                "label": "Dark",
                "selected": true
              },
              {
                "value": "light",
                "label": "Light"
              },
              {
                "value": "colorful",
                "label": "Colourful"
              }
            ]
          }
        ],
        "note": "Adjust the colour theme. Interface scale presets now live under Display."
      },
      {
        "id": "hintTiming",
        "title": "Hint timing",
        "items": [
          {
            "type": "range",
            "id": "hintFadeDuration",
            "label": "Hint fade duration",
            "min": 400,
            "max": 2400,
            "step": 100,
            "value": 1200,
            "default": 1200,
            "format": "seconds"
          }
        ],
        "note": "Control how long hint flashes stay visible. Default 1.2 s.",
        "advancedOnly": true
      },
      {
        "id": "paletteOrder",
        "title": "Palette order",
        "items": [
          {
            "type": "select",
            "id": "paletteSort",
            "label": "Sort the palette",
            "testId": "palette-sort",
            "disabled": true,
            "options": [
              {
                "value": "region",
                "label": "Number"
              },
              {
                "value": "remaining",
                "label": "Remaining regions"
              },
              {
                "value": "name",
                "label": "Colour name"
              },
              {
                "value": "spectrum",
                "label": "Rainbow spectrum"
              },
              {
                "value": "warmth",
                "label": "Warm â†’ cool"
              },
              {
                "value": "lightness",
                "label": "Perceptual lightness"
              }
            ]
          }
        ],
        "note": "Reorder swatches after a puzzle loads: by number, remaining regions, colour name, or spectrum.",
        "advancedOnly": true
      },
      {
        "id": "uiScalePreset",
        "title": "Interface scale",
        "items": [
          {
            "type": "select",
            "id": "uiScale",
            "label": "Interface size",
            "outputFor": "uiScale",
            "options": [
              {
                "value": 0.25,
                "label": "25%"
              },
              {
                "value": 0.5,
                "label": "50%"
              },
              {
                "value": 0.75,
                "label": "75%"
              },
              {
                "value": 1,
                "label": "100%",
                "selected": true
              },
              {
                "value": 1.25,
                "label": "125%"
              },
              {
                "value": 1.5,
                "label": "150%"
              },
              {
                "value": 1.75,
                "label": "175%"
              },
              {
                "value": 2,
                "label": "200%"
              },
              {
                "value": 2.5,
                "label": "250%"
              },
              {
                "value": 3,
                "label": "300%"
              },
              {
                "value": 3.5,
                "label": "350%"
              },
              {
                "value": 4,
                "label": "400%"
              }
            ]
          },
          {
            "type": "note",
            "text": "Choose a preset between 25% and 400% for buttons and menus without affecting puzzle colours. Default 100%."
          }
        ],
        "advancedOnly": true
      },
      {
        "id": "uiScalePreset",
        "title": "Interface scale",
        "items": [
          {
            "type": "select",
            "id": "uiScale",
            "label": "Interface size",
            "outputFor": "uiScale",
            "options": [
              {
                "value": 0.85,
                "label": "Compact (85%)"
              },
              {
                "value": 1,
                "label": "Standard (100%)",
                "selected": true
              },
              {
                "value": 1.15,
                "label": "Comfortable (115%)"
              },
              {
                "value": 1.3,
                "label": "Roomy (130%)"
              },
              {
                "value": 1.5,
                "label": "Large (150%)"
              },
              {
                "value": 1.75,
                "label": "Extra large (175%)"
              },
              {
                "value": 2,
                "label": "Huge (200%)"
              },
              {
                "value": 2.5,
                "label": "Giant (250%)"
              }
            ]
          },
          {
            "type": "note",
            "text": "Choose a preset for buttons and menus without affecting puzzle colours. Default 100%."
          }
        ]
      },
      {
        "id": "labeling",
        "title": "Labels & zoom",
        "items": [
          {
            "type": "range",
            "id": "labelScale",
            "label": "Label size",
            "min": 0.2,
            "max": 2,
            "step": 0.05,
            "value": 1,
            "default": 1,
            "format": "unit-percent"
          },
          {
            "type": "note",
            "text": "Scale region numbers independently from the surrounding interface. Default 100%."
          },
          {
            "type": "range",
            "id": "maxZoom",
            "label": "Maximum zoom",
            "min": 2,
            "max": 30,
            "step": 0.5,
            "value": 12,
            "default": 12,
            "format": "zoom-percent"
          },
          {
            "type": "note",
            "text": "Limit how far the canvas can zoom in beyond the fitted view. Default 1200%."
          },
          {
            "type": "select",
            "id": "rendererMode",
            "label": "Renderer",
            "options": [
              {
                "value": "svg",
                "label": "SVG",
                "selected": true
              }
            ]
          },
          {
            "type": "note",
            "text": "Rendering is handled by the simplified SVG backend."
          }
        ],
        "advancedOnly": true
      },
      {
        "id": "backgrounds",
        "title": "Backgrounds",
        "items": [
          {
            "type": "color",
            "id": "backgroundColor",
            "label": "Unfilled region colour",
            "value": "#f8fafc"
          },
          {
            "type": "note",
            "text": "Applies to unfinished regions and adjusts outline contrast automatically."
          },
          {
            "type": "color",
            "id": "stageBackgroundColor",
            "label": "Background",
            "value": "#000000"
          },
          {
            "type": "note",
            "text": "Adjust the area surrounding the puzzle canvas."
          }
        ],
        "advancedOnly": true
      },
      {
        "id": "mouseControlsHeading",
        "title": "Mouse controls",
        "description": "Assign actions to each mouse button when clicking or click-dragging on the canvas.",
        "items": [
          {
            "type": "mouse-controls",
            "groups": [
              {
                "title": "Left button",
                "options": [
                  {
                    "label": "Click",
                    "id": "mouseLeftClick",
                    "choices": [
                      {
                        "value": "fill",
                        "label": "Fill region",
                        "selected": true
                      },
                      {
                        "value": "select-fill",
                        "label": "Select and fill region"
                      },
                      {
                        "value": "select",
                        "label": "Select colour"
                      },
                      {
                        "value": "zoom-in",
                        "label": "Zoom in"
                      },
                      {
                        "value": "zoom-out",
                        "label": "Zoom out"
                      },
                      {
                        "value": "none",
                        "label": "No action"
                      }
                    ]
                  },
                  {
                    "label": "Click + drag",
                    "id": "mouseLeftDrag",
                    "choices": [
                      {
                        "value": "pan",
                        "label": "Pan view",
                        "selected": true
                      },
                      {
                        "value": "fill",
                        "label": "Fill while dragging"
                      },
                      {
                        "value": "zoom",
                        "label": "Zoom"
                      },
                      {
                        "value": "none",
                        "label": "No action"
                      }
                    ]
                  }
                ]
              },
              {
                "title": "Middle button",
                "options": [
                  {
                    "label": "Click",
                    "id": "mouseMiddleClick",
                    "choices": [
                      {
                        "value": "fill",
                        "label": "Fill region"
                      },
                      {
                        "value": "select-fill",
                        "label": "Select and fill region"
                      },
                      {
                        "value": "select",
                        "label": "Select colour"
                      },
                      {
                        "value": "zoom-in",
                        "label": "Zoom in"
                      },
                      {
                        "value": "zoom-out",
                        "label": "Zoom out"
                      },
                      {
                        "value": "none",
                        "label": "No action",
                        "selected": true
                      }
                    ]
                  },
                  {
                    "label": "Click + drag",
                    "id": "mouseMiddleDrag",
                    "choices": [
                      {
                        "value": "pan",
                        "label": "Pan view",
                        "selected": true
                      },
                      {
                        "value": "fill",
                        "label": "Fill while dragging"
                      },
                      {
                        "value": "zoom",
                        "label": "Zoom"
                      },
                      {
                        "value": "none",
                        "label": "No action"
                      }
                    ]
                  }
                ]
              },
              {
                "title": "Right button",
                "options": [
                  {
                    "label": "Click",
                    "id": "mouseRightClick",
                    "choices": [
                      {
                        "value": "fill",
                        "label": "Fill region"
                      },
                      {
                        "value": "select-fill",
                        "label": "Select and fill region"
                      },
                      {
                        "value": "select",
                        "label": "Select colour",
                        "selected": true
                      },
                      {
                        "value": "zoom-in",
                        "label": "Zoom in"
                      },
                      {
                        "value": "zoom-out",
                        "label": "Zoom out"
                      },
                      {
                        "value": "none",
                        "label": "No action"
                      }
                    ]
                  },
                  {
                    "label": "Click + drag",
                    "id": "mouseRightDrag",
                    "choices": [
                      {
                        "value": "pan",
                        "label": "Pan view",
                        "selected": true
                      },
                      {
                        "value": "fill",
                        "label": "Fill while dragging"
                      },
                      {
                        "value": "zoom",
                        "label": "Zoom"
                      },
                      {
                        "value": "none",
                        "label": "No action"
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "type": "note",
            "text": "Drag-to-zoom adjusts the view by moving up to zoom in or down to zoom out."
          }
        ],
        "advancedOnly": true
      }
    ]
  },
  {
    "id": "create",
    "label": "Create",
    "heading": {
      "title": "Create",
      "helpLabel": "Puzzle creation",
      "helpText": "Tune imports and generation settings for new puzzles."
    },
    "blocks": [
      {
        "type": "import-notice"
      },
      {
        "type": "section",
        "id": "generatorHeading",
        "title": "Clustering & detail",
        "description": "Tune the colour clustering pipeline that powers new puzzles. These settings apply to fresh imports and the bundled capybara sample when reloaded.",
        "items": [
          {
            "type": "detail-callout",
            "captionAttr": "detail-caption",
            "levels": [
              {
                "level": "low",
                "label": "Low"
              },
              {
                "level": "medium",
                "label": "Medium"
              },
              {
                "level": "high",
                "label": "High"
              }
            ]
          },
          {
            "type": "note",
            "text": "Switching presets updates every slider below and reloads the sample scene when it's active."
          },
          {
            "type": "range",
            "id": "colorCount",
            "label": "Colours",
            "min": 4,
            "max": 64,
            "value": 12,
            "default": 12,
            "format": "integer"
          },
          {
            "type": "range",
            "id": "minRegion",
            "label": "Regions",
            "min": 1,
            "max": 600,
            "value": 60,
            "default": 60,
            "format": "px2"
          },
          {
            "type": "note",
            "text": "Higher values merge smaller areas for fewer regions. Default 60 pxÂ²."
          },
          {
            "type": "range",
            "id": "detailLevel",
            "label": "Detail",
            "min": 256,
            "max": 1600,
            "step": 64,
            "value": 640,
            "default": 640,
            "format": "px"
          },
          {
            "type": "note",
            "text": "Controls the longest edge used when resizing the source image. Default 640 px."
          },
          {
            "type": "select",
            "id": "generationAlgorithm",
            "label": "Algorithm",
            "options": [
              {
                "value": "local-kmeans",
                "label": "Local palette clustering (k-means)"
              },
              {
                "value": "local-posterize",
                "label": "Local posterize & merge"
              },
              {
                "value": "organic-slic",
                "label": "Organic superpixels (curved gradients)"
              }
            ]
          },
          {
            "type": "note",
            "text": "Choose between local clustering pipelines now, with space for hosted services to appear as they become available."
          },
          {
            "type": "range",
            "id": "sampleRate",
            "label": "Sample rate",
            "min": 25,
            "max": 100,
            "step": 5,
            "value": 50,
            "default": 50,
            "format": "percent"
          },
          {
            "type": "note",
            "text": "Lower values speed up clustering by sampling fewer pixels. Default 50%."
          },
          {
            "type": "range",
            "id": "kmeansIters",
            "label": "Iterations",
            "min": 4,
            "max": 32,
            "step": 1,
            "value": 12,
            "default": 12,
            "format": "integer"
          },
          {
            "type": "note",
            "text": "Iterations rerun the clustering stage; higher counts refine colour centroids but take longer to process. Default 12 iterations."
          },
          {
            "type": "range",
            "id": "smoothingPasses",
            "label": "Smoothing passes",
            "min": 0,
            "max": 4,
            "step": 1,
            "value": 0,
            "default": 0,
            "format": "integer"
          },
          {
            "type": "note",
            "text": "Each pass blends stray pixels into neighbouring regions before segmentationâ€”set to 0 to keep edges as crisp as the source. Default 0 passes."
          },
          {
            "type": "details",
            "summary": "Advanced options",
            "items": [
              {
                "type": "range",
                "id": "mergePasses",
                "label": "Merge passes",
                "min": 1,
                "max": 24,
                "step": 1,
                "value": 12,
                "default": 12,
                "format": "integer"
              },
              {
                "type": "note",
                "text": "Limits how many merge sweeps run after segmentation to avoid oscillation. Default 12 passes."
              },
              {
                "type": "range",
                "id": "perimeterRatio",
                "label": "Perimeter/area limit",
                "min": 0,
                "max": 3,
                "step": 0.05,
                "value": 1.6,
                "default": 1.6,
                "format": "ratio"
              },
              {
                "type": "note",
                "text": "Regions above this perimeter-to-area ratio merge into dominant neighbours; set to 0 to disable. Default 1.6."
              },
              {
                "type": "textarea",
                "id": "artPrompt",
                "label": "Art prompt",
                "rows": 3,
                "placeholder": "Summarise the idea behind this puzzle"
              },
              {
                "type": "note",
                "text": "Stored with saves so you can revisit the inspiration that sparked the artwork."
              },
              {
                "type": "textarea",
                "id": "imageDescription",
                "label": "Image description",
                "rows": 3,
                "placeholder": "Describe the image you want to generate"
              },
              {
                "type": "note",
                "text": "Stored with saves and exports so you can revisit the inspiration later."
              },
              {
                "type": "note",
                "link": {
                  "href": "https://chat.openai.com/",
                  "text": "Open ChatGPT to craft an image prompt",
                  "id": "chatGptLink"
                }
              }
            ]
          }
        ]
      },
      {
        "type": "source-url-form"
      },
      {
        "type": "sheet-actions"
      },
      {
        "type": "generator-progress"
      }
    ],
    "advancedOnly": true
  },
  {
    "id": "guides",
    "label": "Guides",
    "heading": {
      "title": "Guides",
      "helpLabel": "Gestures, shortcuts, and documentation",
      "helpText": "Review inputs, commands, and the built-in README without leaving the puzzle."
    },
    "sections": [
      {
        "id": "commandsHeading",
        "title": "Command buttons",
        "items": [
          {
            "type": "definition-list",
            "items": [
              {
                "term": "ðŸ–¼ Preview",
                "description": "Toggle the finished artwork overlay to compare your progress."
              },
              {
                "term": "ðŸŽ› Generator",
                "description": "Adjust clustering sliders, choose capybara detail presets, reload the current source image, and monitor generation progress. The sheet mirrors the k-means pipeline inputs used for puzzle creation."
              },
              {
                "term": "ðŸŽš Detail",
                "description": "Toggle the capybara detail chips in the Generator sheet to reload the sample with tuned palette sizes, minimum region areas, resize targets, and the region counts noted above."
              },
              {
                "term": "â›¶ Fullscreen",
                "description": "Expand the app to fill the display or exit back to windowed mode."
              },
              {
                "term": "â¬† Import",
                "description": "Load a new image or JSON puzzle from disk."
              },
              {
                "term": "ðŸ’¾ Saves",
                "description": "Manage snapshots â€” load, rename, export, or delete stored games."
              },
              {
                "term": "â„¹ Help",
                "description": "Open this guide and review tips for palette controls, gestures, and shortcuts."
              },
              {
                "term": "âš™ Menu",
                "description": "Toggle auto-advance, customise hints, change the background or theme, sort the palette, and adjust the interface scale. Advanced options expose accessibility tweaks for the hint animations."
              }
            ]
          }
        ],
        "advancedOnly": true
      },
      {
        "id": "controlsHeading",
        "title": "Canvas controls",
        "items": [
          {
            "type": "list",
            "items": [
              "Click Fill the tapped region if it matches the active colour.",
              "Right click Select the colour under the pointer.",
              "Select a palette swatch to set the active colour and flash every matching region.",
              "Enable Easy difficulty in the menu to let clicks auto-select the tapped region's colour.",
              "Mouse wheel or +/âˆ’ Zoom in or out around the cursor.",
              "Middle click or Space + drag Pan the canvas.",
              "Drag & drop an image or JSON file anywhere on the window to import it."
            ]
          }
        ],
        "advancedOnly": true
      }
    ],
    "advancedOnly": true
  },
  {
    "id": "debug",
    "label": "Debug",
    "heading": {
      "title": "Debug",
      "helpLabel": "Debug and system info",
      "helpText": "Inspect logs and service worker state while troubleshooting."
    },
    "blocks": [
      {
        "type": "loader-console"
      },
      {
        "type": "section",
        "id": "advancedSettings",
        "title": "Advanced settings",
        "items": [
          {
            "type": "note",
            "text": "Show experimental controls and deeper configuration across the menu."
          },
          {
            "type": "toggle",
            "id": "advancedModeToggle",
            "label": "Show advanced settings"
          }
        ]
      },
      {
        "type": "section",
        "id": "systemHeading",
        "title": "System status",
        "items": [
          {
            "type": "definition-list",
            "items": [
              {
                "term": "Service worker",
                "description": "Waiting to registerâ€¦",
                "dataTarget": "service-worker-state"
              },
              {
                "term": "Runtime cache",
                "description": "capy-offline-cache-v3",
                "dataTarget": "service-worker-cache"
              },
              {
                "term": "Last update",
                "description": "Not available yet",
                "dataTarget": "service-worker-updated"
              }
            ]
          },
          {
            "type": "note",
            "text": "Service worker registration, cache limits, and install events stream into the debug log below."
          }
        ]
      },
      {
        "type": "section",
        "id": "saveMaintenance",
        "title": "Saves",
        "items": [
          {
            "type": "button-row",
            "className": "log-actions",
            "actions": [
              {
                "type": "button",
                "id": "deleteAllSaves",
                "label": "Delete all saves"
              }
            ]
          }
        ]
      },
      {
        "type": "section",
        "id": "debugHeading",
        "title": "Debug log",
        "items": [
          {
            "type": "logger",
            "id": "debugLog"
          },
          {
            "type": "button-row",
            "className": "log-actions",
            "actions": [
              {
                "type": "button",
                "id": "clearDebugLog",
                "label": "Clear log"
              }
            ]
          }
        ]
      },
      {
        "type": "section",
        "id": "settingsJsonHeading",
        "title": "Preferences JSON",
        "items": [
          {
            "type": "note",
            "text": "Review or update the current preferences as JSON. Export a snapshot or import one from the textarea below."
          },
          {
            "type": "json-view"
          }
        ]
      }
    ]
  }
]
</script>
  </body>
</html>
