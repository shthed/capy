@import url("https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css");

/*
  This file keeps only the layout and overlay rules that Pico does not provide out of the box.
  Everything else leans on Pico's spacing, typography, and theme tokens so we don't maintain
  a custom design system.
*/

/*
  Theme hints for the browser's built-in widgets. The scripts toggle data-theme on <body>, so
  we mirror that into the color-scheme property to keep form controls in sync with the active
  light/dark choice.
*/
:root {
  color-scheme: light dark;
  --command-rail-height: 64px;
  --stage-gap: 1rem;
}

body[data-theme="light"] {
  color-scheme: light;
}

body[data-theme="dark"],
body:not([data-theme]) {
  color-scheme: dark;
}

body[data-theme="colorful"] {
  color-scheme: dark;
}

/* Accessibility helper used throughout the markup. Pico provides a sr-only utility in v2, but
   this project already relies on the classic visually-hidden pattern and keeps it for clarity. */
.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Runtime toggles `.hidden` to park overlays without removing them from the DOM. */
.hidden {
  display: none !important;
}

/*
  Basic reset for the game shell: remove the default margin so the app can fill the viewport and
  prevent pull-to-refresh/overscroll artifacts while panning the canvas.
*/
body {
  margin: 0;
  min-height: 100vh;
  background-color: var(--pico-background-color);
  color: var(--pico-color);
  font-size: calc(16px * var(--ui-scale, 1));
  touch-action: manipulation;
  overscroll-behavior: none;
}

/* State cursors that mirror interaction mode from the scripts. */
body.dragging {
  cursor: copy;
}

body.panning {
  cursor: grabbing;
}

/* Container that matches the script-driven viewport sizing logic. */
#app {
  position: relative;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  width: min(var(--app-width, 100vw), 100vw);
  height: min(var(--app-height, 100vh), 100vh);
  overflow: hidden;
}

/* Fixed command rail anchored to the top-right. Pico handles button styling; we only place it. */
#commandRail {
  position: fixed;
  top: calc(env(safe-area-inset-top, 0px) + 1rem);
  right: calc(env(safe-area-inset-right, 0px) + 1rem);
  display: flex;
  gap: 0.5rem;
  z-index: 10;
}

/*
  Viewport and stage rules that allow the puzzle canvas to stay centered while scripts translate
  and scale it. Pico's containers do not cover this transform-heavy behavior, so we keep a small
  set of layout hooks here.
*/
#viewport {
  position: relative;
  flex: 1 1 auto;
  display: grid;
  place-items: center;
  padding: var(--viewport-padding, 1rem);
  padding-top: calc(var(--command-rail-top, 0px) + var(--command-rail-height));
  margin: var(--stage-gap);
  overflow: hidden;
  background: var(--pico-muted-border-color);
  border-radius: 1rem;
}

#canvasStage {
  position: absolute;
  top: 50%;
  left: 50%;
  --pan-x: 0px;
  --pan-y: 0px;
  transform: translate3d(calc(-50% + var(--pan-x)), calc(-50% + var(--pan-y)), 0);
  display: flex;
  align-items: center;
  justify-content: center;
  touch-action: none;
  will-change: transform;
  cursor: grab;
}

#canvasTransform {
  transform-origin: center;
}

canvas {
  display: block;
  max-width: 100%;
  height: auto;
}

/* Hide the native cursor when the custom pointer overlay is active. */
body.custom-cursor:not(.panning) #canvasStage {
  cursor: none;
}

/* Error toast needs fixed positioning so it does not push the canvas layout. The rest borrows
   Pico's colour tokens for contrast without bespoke decoration. */
#errorToast {
  position: fixed;
  top: calc(env(safe-area-inset-top, 0px) + 1rem);
  right: calc(env(safe-area-inset-right, 0px) + 1rem);
  z-index: 2000;
  max-width: 420px;
  background: var(--pico-card-background-color);
  border: 1px solid var(--pico-muted-border-color);
  border-radius: 0.75rem;
  padding: 1rem;
  display: grid;
  gap: 0.75rem;
}

/*
  Pointer overlay draws the preview ring and tooltip that track the cursor. Positioning stays
  outside Pico's scope, so these rules are minimal but essential for the feature to render.
*/
#pointerOverlay {
  --cursor-x: -9999px;
  --cursor-y: -9999px;
  position: fixed;
  inset: 0;
  pointer-events: none;
  transform: translate3d(var(--cursor-x), var(--cursor-y), 0);
  z-index: 6;
}

.pointer-indicator {
  width: 18px;
  height: 18px;
  border: 2px solid currentColor;
  border-radius: 999px;
  background: transparent;
  opacity: 0;
  transition: opacity 120ms ease;
}

#pointerOverlay.active .pointer-indicator {
  opacity: 0.7;
}

.pointer-tooltip {
  margin-top: 0.25rem;
  padding: 0.4rem 0.6rem;
  border-radius: 0.6rem;
  background: var(--pico-card-background-color);
  border: 1px solid var(--pico-muted-border-color);
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.35);
}

.pointer-swatch {
  display: inline-flex;
  width: 18px;
  height: 18px;
  border-radius: 4px;
  border: 1px solid var(--pico-muted-border-color);
}

.pointer-number {
  font-size: 1rem;
  margin: 0;
}

/* Start hint card sits atop the viewport until dismissed. Positioning keeps it visible without
   disrupting the stage layout; styling leans on Pico tokens for contrast. */
#startHint {
  position: absolute;
  left: var(--viewport-padding, 1rem);
  bottom: var(--viewport-padding, 1rem);
  max-width: min(420px, calc(100% - (var(--viewport-padding, 1rem) * 2)));
  padding: 1rem;
  background: var(--pico-card-background-color);
  border: 1px solid var(--pico-muted-border-color);
  border-radius: 0.9rem;
  box-shadow: 0 0.75rem 2rem rgba(0, 0, 0, 0.25);
  display: grid;
  gap: 0.75rem;
}

/* Palette dock sticks to the bottom of the viewport and keeps colours horizontally scrollable. */
#paletteDock {
  position: sticky;
  bottom: 0;
  left: 0;
  right: 0;
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  padding: 0.75rem;
  background: var(--pico-card-background-color);
  border-top: 1px solid var(--pico-border-color);
  z-index: 3;
}

#palette {
  display: flex;
  gap: 0.35rem;
  overflow-x: auto;
  padding-block-end: 0.25rem;
}

#palette::-webkit-scrollbar {
  height: 6px;
}

#palette::-webkit-scrollbar-thumb {
  background: var(--pico-muted-border-color);
}

.palette-color {
  min-width: 48px;
  padding: 0.35rem 0.5rem;
  border-radius: 0.75rem;
  border: 1px solid var(--pico-muted-border-color);
  background: var(--pico-primary-background);
  color: var(--pico-primary);
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  cursor: pointer;
}

.palette-color.active {
  box-shadow: 0 0 0 2px var(--pico-primary-focus);
}

.palette-swatch {
  width: 18px;
  height: 18px;
  border-radius: 4px;
  border: 1px solid var(--pico-muted-border-color);
}

/* Modal sheet and backdrop used by the settings dialog. Positioning stays custom to match the
   slide-up tray behavior while inheriting Pico's card colours and spacing tokens. */
#settingsSheet {
  position: fixed;
  inset: auto 0 0 0;
  margin: 0 auto;
  max-width: 720px;
  max-height: min(80vh, 780px);
  background: var(--pico-card-background-color);
  color: inherit;
  border-radius: 1rem 1rem 0 0;
  border: 1px solid var(--pico-border-color);
  box-shadow: 0 1rem 2.5rem rgba(0, 0, 0, 0.35);
  padding: 1rem;
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 1rem;
  z-index: 12;
}

.sheet-body {
  overflow-y: auto;
  display: grid;
  gap: 1rem;
  padding-inline-end: 0.25rem;
}

.sheet-section {
  padding: 0.5rem 0.75rem;
  border-radius: 0.75rem;
  border: 1px solid var(--pico-muted-border-color);
  background: var(--pico-background-color);
  display: grid;
  gap: 0.75rem;
}

.sheet-footer {
  display: flex;
  justify-content: space-between;
  gap: 0.5rem;
  align-items: center;
}

#backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(2px);
  z-index: 11;
}

/* Disable touch-action on floating UI that should not intercept pointer gestures for panning. */
#pointerOverlay,
#commandRail,
#settingsSheet,
#backdrop {
  touch-action: none;
}
